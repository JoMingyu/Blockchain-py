# min-blockchain
A simple PoW Blockchain in Python

## BlockChain
블록체인은 Genesis Block부터 시작해서 바로 앞의 블록에 대한 링크를 가지고 있는 linked list이다. 블록체인은 여러 노드에 걸쳐 분산되어 저장 및 관리되며, 블록에는 거래 정보가 포함되어 있으므로 블록의 집합인 블록체인은 모든 거래 정보를 포함하는 거대한 분산 장부라고 볼 수 있다.

## Block
블록은 블록체인의 원소로서 다수의 거래 정보의 묶음을 의미한다. 블록 헤더는 6개의 정보(version, previous block hash, merkle hash, time, bits, nonce)로 구성된다.
### Block Header
- version : 소프트웨어/프로토콜 버전
- previous block hash : 블록체인에서 바로 앞에 위치하는 블록의 블록 해쉬
- merkle hash : 개별 거래 정보의 거래 해쉬를 2진 트리(머클 트리) 형태로 구성할 때, 트리 루트에 위치하는 해쉬값
- time : 블록이 생성된 시간
- bits : 작업 난이도
- nonce : PoW 알고리즘에서 사용되는 변수. 최초 0에서 시작하여 조건을 만족하는 해쉬값을 찾아낼때까지의 계산 회수(1씩 증가)
### Block Hash
블록의 식별자 역할을 하는 블록 해쉬는 위의 6가지 블록 헤더 정보를 입력값으로 하고, 여기에 SHA256 해시 함수를 2회 적용해서 계산되는 값으로 32바이트의 숫자값이다. 이 값은 블록 전체를 해쉬한 것이 아니라, 블록 헤더를 해쉬한 값이다.

그렇다면, 개별 거래가 생겨났을 때 이 거래들은 각자의 해쉬값이 생기며 이들이 모여 머클 트리를 이루고 이 트리에 해당하는 해쉬값이 생겨나게 된다. 그리고 나머지 헤더의 요소(버전, 앞 블록의 블록 해쉬, 생성시각 등)와 모여 블록 헤더를 이루게 된다. 이에 2회의 SHA256 해시를 거치면 블록 해쉬를 얻어낼 수 있다.

## Proof of Work(작업 증명)
작업 증명은 새로운 블록을 블록체인에 추가하는 작업을 완료했음을 증명하는 것이다. 새로운 블록을 블록체인에 추가하려면, 그 새로운 블록의 결과 해쉬보다 낮은 블록 해쉬를 계산해야 하고, 그 블록 해쉬를 계산하려면 그 블록의 헤더 정보중 하나인 nonce 값 계산을 통해 구해야 한다. 결론적으로 이 nonce 값을 구하는 것이 바로 작업 증명이다.
### nonce
역산 불가능한 해쉬 함수의 특성 상, 어떤 해쉬값 A를 결과로 나오게 하는 입력값을 찾으려면 결과가 A가 될 때까지 무작위로 입력값을 계속 바꿔가면서 찾아내야 한다. 그 입력 값을 바꿀 수 있는 유일한 통로가 헤더에서 유일하게 확정되지 않은 값인 nonce이다. 그렇다면, 작업 증명자(채굴자)의 입장에서는 블록 헤더의 nonce를 바꿔가며 블록 해쉬를 찾아내는 것이다. nonce가 적게는 수백 개, 많게는 수억 개씩 올라가며 블록 해시를 만들어내며, 작업 증명의 성공 여부를 판단한다.
### 작업 증명 성공 여부의 증명
한 블록의 해쉬 결과가 A라고 치면, 작업 증명자는 nonce를 늘려가며 작업 증명 성공 여부를 비교한다. 그럼 해쉬 결과인 A는 어떻게 결정되는 것일까.

바로 블록 헤더의 bits(작업 난이도)에 의해 결정된다. 블록 해쉬가 특정 숫자보다 낮게 나올 때의 nonce 값을 찾아내는 것이 작업 증명인데, bits는 nonce 값 계산의 난이도를 나타낸다. 앞에서 블록 해쉬는 32바이트의 숫자라고 했는데, 일단 블록 해쉬를 부호 없는 1바이트의 숫자라고 쳐 보자. 그럼 1바이트의 숫자값을 블록 해쉬값으로 산출하는 해쉬 함수는 0 ~ 255 사이의 값을 결과로 산출한다. 블록 해쉬가 128보다 작아야 한다고 치면, 해쉬 함수를 적용하여 128보다 작은 블록 해쉬값이 나올 확률은 50%이다. 블록 해쉬가 64보다 작아야 한다면 25%, 32보다 작아야 한다면 12.5%로 줄어든다. 여기서 128, 64, 32라는 특정 숫자가 바로 블록 헤더 정보의 bits이다.
### 보상
보상은 새로 발행되는 코인과 해당 블록에 포함되는 거래 수수료를 포함한다. 예를 들어 비트코인의 발행은, 채굴자가 블록을 처음 구성할 때 채굴자의 지갑으로 일정량의 비트코인이 입금되는 거래를 그 블록의 첫 거래(generation transaction)로 추가하는 방식으로 시작했다. 새로 발행되는 비트코인은 최초에 50BTC에서 시작하였고 블록체인에 21만개의 블록이 추가될 때마다 절반으로 줄어든다. nonce 값을 찾아내고, 그 결과로 새로운 블록을 블록체인에 추가해서, 해당 블록에 포함된 모든 거래를 유효한 거래로 확정시켜 준 대가라고 할 수 있다. 
